<div class="container">
    <div style="align-content: center" class="row">
        <div class="col">
            <h1>Status</h1>
            <p id="status"></p>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <h1>Letzte Aufnahme</h1>
            <div style="height: 400px; overflow: scroll" id="aufnahmen"></div>
        </div>
    </div>
</div>

<script type="text/javascript">
    var socket = new WebSocket("ws://localhost:8080/ws_notification");
    var downloaded_images = [];

    download_new_images()
    get_and_set_status()

    socket.onmessage = function (msg) {
        console.log(msg.data);
        download_new_images()
        get_and_set_status()
    }

    function get_and_set_status() {
        fetch("/status")
            .then(response => response.json())
            .then(status => document.getElementById("status")
                .innerHTML = status)
    }

    async function get_image_list() {
        return await fetch("/media_content")
            .then(response => response.json())
    }

    async function download_new_images() {
        const all_images = await get_image_list()
        const new_images = arr_diff(all_images, downloaded_images);
        for (const image_name of new_images) {
            downloaded_images.push(image_name)
            const img = document.createElement("img");
            img.setAttribute("src", image_name);
            document.getElementById("aufnahmen").appendChild(img)
        }
    }

    function arr_diff(a1, a2) {
        var a = [], diff = [];
        for (var i = 0; i < a1.length; i++) {
            a[a1[i]] = true;
        }
        for (var i = 0; i < a2.length; i++) {
            if (a[a2[i]]) {
                delete a[a2[i]];
            } else {
                a[a2[i]] = true;
            }
        }
        for (var k in a) {
            diff.push(k);
        }
        return diff;
    }
</script>